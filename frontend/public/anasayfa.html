<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoSafe | Afet YÃ¶netim Paneli</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root {
            --soft-aqua: #f0fdfa;
            --header-green: #245a56; 
            --primary-teal: #2d3748;
            --danger-red: #e53e3e;
            --hover-red: #c53030;
            --hover-green: #1a4542;
            --white-glass: rgba(255, 255, 255, 0.95);
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--soft-aqua); margin: 0; color: #2d3748; }

        /* NAVBAR */
        header {
            background-color: var(--header-green);
            padding: 15px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 2000;
        }

        .header-left { display: flex; align-items: baseline; gap: 15px; }
        .header-left h1 { margin: 0; font-weight: 800; font-size: 26px; letter-spacing: -1px; }
        .header-left span { font-size: 14px; font-weight: 400; opacity: 0.9; }

        .header-right { display: flex; gap: 12px; align-items: center; }
        
        /* PROFIL DROPDOWN CSS */
        .profile-container { position: relative; padding-bottom: 10px; margin-bottom: -10px; }
        
        .profile-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            width: 300px;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            padding: 20px;
            margin-top: 5px;
            z-index: 3000;
            color: #2d3748;
            border: 2px solid var(--soft-aqua);
        }
        
        .profile-container:hover .profile-dropdown { display: block; }

        .profile-dropdown h3 { margin: 0 0 15px 0; font-size: 16px; color: var(--header-green); border-bottom: 2px solid var(--soft-aqua); padding-bottom: 8px; }
        .profile-form { display: flex; flex-direction: column; gap: 8px; text-align: left; }
        .profile-form label { font-size: 10px; font-weight: 700; color: #718096; text-transform: uppercase; }
        .profile-form input { width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; box-sizing: border-box; background: #f8fafc; }
        .profile-form input:focus { outline: none; border-color: var(--header-green); background-color: #fff; }
        .profile-form input[readonly] { background-color: #f1f5f9; cursor: not-allowed; }
        
        .note-text { font-size: 11px; color: #e53e3e; font-style: italic; margin-top: 5px; line-height: 1.2; }

        .button-group { display: flex; gap: 8px; margin-top: 10px; }
        .action-btn { flex: 1; border: none; padding: 10px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.2s; font-size: 12px; }
        .update-mode-btn { background-color: #edf2f7; color: var(--primary-teal); border: 1px solid #cbd5e0; }
        .save-btn { background-color: var(--header-green); color: white; }
        .save-btn:hover { background-color: var(--hover-green); transform: translateY(-1px); }

        .nav-btn {
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            display: inline-flex;
            align-items: center;
        }
        .profile-btn:hover { background-color: var(--hover-green); }
        .logout-btn { background-color: var(--danger-red); border: none; }
        .logout-btn:hover { background-color: var(--hover-red); }

        /* ANA Ä°Ã‡ERÄ°K */
        .main-container {
            max-width: 1300px;
            margin: 30px auto;
            display: flex; gap: 25px; padding: 0 20px; height: 500px;
        }

        #map { flex: 2; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 4px solid white; position: relative; }

        .info-card {
            flex: 1; background: var(--white-glass);
            border-radius: 20px; padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.04);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
            border: 1px solid white;
        }

        .info-content { width: 100%; display: none; }
        .welcome-box { display: block; }
        .area-title { color: var(--header-green); font-size: 24px; margin-bottom: 10px; font-weight: 700; }
        
        .inventory-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; margin: 20px 0; }
        .inv-item { background: white; padding: 15px; border-radius: 12px; border: 1px solid #edf2f7; display: flex; flex-direction: column; gap: 5px; }
        .inv-item span { font-size: 12px; color: #718096; text-transform: uppercase; font-weight: 600; }
        .inv-item b { font-size: 16px; color: var(--primary-teal); }

        .distance-badge { background: var(--header-green); color: white; padding: 15px 25px; border-radius: 15px; font-weight: 700; width: 80%; margin-top: 20px; }

        /* DEPREM TABLOSU */
        .eq-section { max-width: 1300px; margin: 40px auto; padding: 0 20px; }
        .eq-card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.03); }
        .eq-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .eq-table th { text-align: left; padding: 15px; color: #718096; border-bottom: 2px solid #edf2f7; font-size: 13px; }
        .eq-table td { padding: 18px 15px; border-bottom: 1px solid #f7fafc; font-size: 14px; }
        .mag-tag { padding: 6px 14px; border-radius: 8px; color: white; font-weight: 800; display: inline-block; min-width: 35px; text-align: center; }

        /* EÄÄ°TÄ°M PANELÄ° */
        .edu-wrapper { max-width: 1100px; margin: 60px auto; padding: 0 20px; margin-bottom: 80px; }
        .edu-header { margin-bottom: 25px; border-left: 4px solid var(--header-green); padding-left: 12px; }
        .edu-header h2 { font-family: 'Montserrat', sans-serif; font-size: 20px; color: var(--header-green); text-transform: uppercase; margin: 0; }
        
        .video-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .video-card { width: 100%; border-radius: 16px; overflow: hidden; transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.8); box-shadow: 0 4px 12px rgba(0,0,0,0.04); display: flex; flex-direction: column; }
        
        .card-1 { background-color: #b2d8d8; } .card-2 { background-color: #d1e7e0; } .card-3 { background-color: #a3c4bc; }
        .card-4 { background-color: #9abfb6; } .card-5 { background-color: #c2dcd6; } .card-6 { background-color: #d8ece7; }

        .video-card:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        .video-thumb { position: relative; width: 100%; padding-top: 56.25%; background: #000; }
        .video-thumb iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        
        .card-content { padding: 15px; flex-grow: 1; }
        .category-tag { font-size: 9px; text-transform: uppercase; font-weight: 800; color: var(--header-green); margin-bottom: 6px; display: block; opacity: 0.8; }
        .video-title { font-size: 13.5px; color: var(--primary-teal); margin: 0; font-weight: 700; height: 2.8em; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.4; }
        .card-footer { margin-top: 12px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.04); }
        .view-btn { color: var(--header-green); font-size: 11px; text-decoration: none; font-weight: 700; display: flex; align-items: center; gap: 5px; }

        @media (max-width: 900px) { .video-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .video-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <h1>GeoSafe</h1>
        <span>Afet YÃ¶netim ve GÃ¼venli Toplanma AÄŸÄ±</span>
    </div>
    <div class="header-right">
        <div class="profile-container">
            <a href="#" class="nav-btn profile-btn">Profilim</a>
            <div class="profile-dropdown">
                <h3>KiÅŸisel Bilgiler</h3>
                <div class="profile-form">
                    <div><label>Ad - Soyad</label><input type="text" id="u-name" placeholder="Ad Soyad" readonly></div>
                    <div><label>Kan Grubu</label><input type="text" id="u-blood" placeholder="0 Rh+" readonly></div>
                    <div><label>Kronik RahatsÄ±zlÄ±k</label><input type="text" id="u-chronic" placeholder="Varsa belirtin" readonly></div>
                    <div><label>KullanÄ±lan Ä°laÃ§lar</label><input type="text" id="u-meds" placeholder="Ä°laÃ§larÄ±nÄ±z" readonly></div>
                    <div><label>Alerjiler</label><input type="text" id="u-allergy" placeholder="Alerjileriniz" readonly></div>
                    <div><label>YakÄ±n Telefon No</label><input type="tel" id="u-phone" placeholder="05xx" readonly></div>
                    <p class="note-text">Not : GirdiÄŸiniz bilgileri kaydetmek iÃ§in 'Kaydet' butonuna basÄ±nÄ±z.</p>
                    <div class="button-group">
                        <button type="button" class="action-btn update-mode-btn" onclick="enableEdit()">Bilgileri GÃ¼ncelle</button>
                        <button type="button" class="action-btn save-btn" onclick="saveProfile()">Kaydet</button>
                    </div>
                </div>
            </div>
        </div>
        <a href="index.html" class="nav-btn logout-btn">Ã‡Ä±kÄ±ÅŸ Yap</a>
    </div>
</header>

<div class="main-container">
    <div id="map"></div>
    <div class="info-card">
        <div id="welcome-msg" class="welcome-box">
            <div style="font-size: 50px; margin-bottom: 15px;">ğŸ“</div>
            <h2 style="margin:0; font-size: 22px;">HoÅŸ Geldiniz</h2>
            <p style="color: #718096; font-size: 14px;">DetaylarÄ± gÃ¶rmek iÃ§in haritadan bir toplanma alanÄ± seÃ§iniz.</p>
        </div>
        <div id="details" class="info-content">
            <h2 id="a-name" class="area-title">-</h2>
            <div class="inventory-grid">
                <div class="inv-item"><span>ğŸ’§ Su Rezervi</span><b id="a-water">-</b></div>
                <div class="inv-item"><span>ğŸ©¹ TÄ±bbi Kit</span><b id="a-med">-</b></div>
                <div class="inv-item"><span>ğŸ§¯ YangÄ±n TÃ¼pÃ¼</span><b id="a-ext">-</b></div>
                <div class="inv-item"><span>ğŸ¥« GÄ±da Kolisi</span><b id="a-food">-</b></div>
                <div class="inv-item"><span>ğŸ§£ Battaniye</span><b id="a-blanket">-</b></div>
            </div>
            <div class="distance-badge" id="a-dist">HesaplanÄ±yor...</div>
        </div>
    </div>
</div>

<div class="eq-section">
    <div class="eq-card">
        <h2 style="margin:0; font-size: 18px; display: flex; align-items: center; gap: 10px;">
            ğŸ”´ Son Dakika Depremler <span style="font-weight: 400; font-size: 13px; color: #a0aec0;">(Son 10 GÃ¼n / 4.0+)</span>
        </h2>
        <table class="eq-table">
            <thead>
                <tr><th>BÃœYÃœKLÃœK</th><th>KONUM / YER</th><th>TARÄ°H - SAAT</th><th>DERÄ°NLÄ°K</th></tr>
            </thead>
            <tbody id="eq-list">
                <tr><td colspan="4" style="text-align: center; padding: 40px; color: #a0aec0;">Veriler gÃ¼venli kaynaktan Ã§ekiliyor...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div class="edu-wrapper">
    <div class="edu-header">
        <h2>Afet HazÄ±rlÄ±k EÄŸitimleri</h2>
    </div>

    <div class="video-grid">
        <div class="video-card card-1">
            <div class="video-thumb"><iframe id="player1" src="https://www.youtube.com/embed/K0keerAalYE?enablejsapi=1" allowfullscreen></iframe></div>
            <div class="card-content">
                <span class="category-tag">HazÄ±rlÄ±k</span>
                <h3 class="video-title">Afet ve Acil Durum Ã‡antasÄ± NasÄ±l HazÄ±rlanÄ±r?</h3>
                <div class="card-footer"><a href="https://youtu.be/K0keerAalYE" target="_blank" class="view-btn">YouTube'da Ä°zle âœ</a></div>
            </div>
        </div>
        <div class="video-card card-2">
            <div class="video-thumb"><iframe id="player2" src="https://www.youtube.com/embed/oZeI0X40EEY?enablejsapi=1" allowfullscreen></iframe></div>
            <div class="card-content">
                <span class="category-tag">Deprem</span>
                <h3 class="video-title">Deprem AnÄ±nda YapÄ±lmasÄ± Gerekenler</h3>
                <div class="card-footer"><a href="https://youtu.be/oZeI0X40EEY" target="_blank" class="view-btn">YouTube'da Ä°zle âœ</a></div>
            </div>
        </div>
        <div class="video-card card-3">
            <div class="video-thumb"><iframe id="player3" src="https://www.youtube.com/embed/yQjUhzNMNe8?enablejsapi=1" allowfullscreen></iframe></div>
            <div class="card-content">
                <span class="category-tag">YangÄ±n</span>
                <h3 class="video-title">YangÄ±n AnÄ±nda YapÄ±lmasÄ± Gerekenler</h3>
                <div class="card-footer"><a href="https://youtu.be/yQjUhzNMNe8" target="_blank" class="view-btn">YouTube'da Ä°zle âœ</a></div>
            </div>
        </div>
        <div class="video-card card-4">
            <div class="video-thumb"><iframe id="player4" src="https://www.youtube.com/embed/jy2yf7a5A10?enablejsapi=1" allowfullscreen></iframe></div>
            <div class="card-content">
                <span class="category-tag">Sel</span>
                <h3 class="video-title">Sel AnÄ±nda YapÄ±lmasÄ± Gerekenler</h3>
                <div class="card-footer"><a href="https://youtu.be/jy2yf7a5A10" target="_blank" class="view-btn">YouTube'da Ä°zle âœ</a></div>
            </div>
        </div>
        <div class="video-card card-5">
            <div class="video-thumb"><iframe id="player5" src="https://www.youtube.com/embed/IPkQdDeW6Xg?enablejsapi=1" allowfullscreen></iframe></div>
            <div class="card-content">
                <span class="category-tag">FarkÄ±ndalÄ±k</span>
                <h3 class="video-title">Afet FarkÄ±ndalÄ±k EÄŸitimi</h3>
                <div class="card-footer"><a href="https://youtu.be/IPkQdDeW6Xg" target="_blank" class="view-btn">YouTube'da Ä°zle âœ</a></div>
            </div>
        </div>
        <div class="video-card card-6">
            <div class="video-thumb"><iframe id="player6" src="https://www.youtube.com/embed/eYLu7dh6nUI?enablejsapi=1" allowfullscreen></iframe></div>
            <div class="card-content">
                <span class="category-tag">Ä°lk YardÄ±m</span>
                <h3 class="video-title">Ä°lk YardÄ±m EÄŸitimi</h3>
                <div class="card-footer"><a href="https://youtu.be/eYLu7dh6nUI" target="_blank" class="view-btn">YouTube'da Ä°zle âœ</a></div>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // HARÄ°TA VE DEPREM FONKSÄ°YONLARI (KORUNAN TAM HALÄ°)
    const map = L.map('map', {zoomControl: true}).setView([41.043, 29.008], 14);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

    let userLoc = [41.043, 29.008];
    navigator.geolocation.getCurrentPosition(p => {
        userLoc = [p.coords.latitude, p.coords.longitude];
        L.circleMarker(userLoc, {radius: 7, fillColor: '#3182ce', color: '#fff', weight: 2, fillOpacity: 1}).addTo(map).bindPopup("Siz");
    });

    async function getEarthquakes() {
        const list = document.getElementById('eq-list');
        const apiUrl = 'https://api.orhanaydogdu.com.tr/deprem/kandilli/live';
        const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(apiUrl);
        try {
            const response = await fetch(proxyUrl);
            const data = await response.json();
            list.innerHTML = '';
            const tenDaysAgo = new Date(); tenDaysAgo.setDate(tenDaysAgo.getDate() - 10);
            const filtered = data.result.filter(eq => {
                const parts = eq.date.split('.');
                const eqDate = new Date(`${parts[2]}-${parts[1]}-${parts[0]}`);
                return eq.mag >= 4.0 && eqDate >= tenDaysAgo;
            });
            if(filtered.length === 0) {
                list.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:30px;">Son 10 gÃ¼nde 4.0+ ÅŸiddetinde deprem kaydÄ± bulunamadÄ±.</td></tr>';
                return;
            }
            filtered.forEach(eq => {
                const color = eq.mag >= 5.0 ? '#e53e3e' : '#ed8936';
                list.insertAdjacentHTML('beforeend', `<tr>
                    <td><span class="mag-tag" style="background:${color}">${eq.mag}</span></td>
                    <td><b>${eq.title}</b></td>
                    <td>${eq.date}</td>
                    <td>${eq.depth} km</td>
                </tr>`);
            });
        } catch (e) { list.innerHTML = '<tr><td colspan="4" style="text-align:center; color:red; padding:20px;">Veri Ã§ekilemedi.</td></tr>'; }
    }
    getEarthquakes();

    const locations = [
        { n: "AbbasaÄŸa ParkÄ±", c: [41.0461, 29.0035], s: ["%90", "%65", "15", "%80", "120"] },
        { n: "MaÃ§ka ParkÄ±", c: [41.0475, 28.9942], s: ["%100", "%80", "30", "%95", "450"] },
        { n: "YÄ±ldÄ±z ParkÄ±", c: [41.0485, 29.0185], s: ["%85", "%50", "12", "%75", "200"] },
        { n: "OrtakÃ¶y MeydanÄ±", c: [41.0472, 29.0253], s: ["%60", "%30", "5", "%40", "80"] },
        { n: "Bebek ParkÄ±", c: [41.0772, 29.0435], s: ["%95", "%70", "20", "%85", "150"] },
        { n: "Akatlar ParkÄ±", c: [41.0855, 29.0245], s: ["%100", "%90", "40", "%95", "500"] },
        { n: "KuruÃ§eÅŸme ParkÄ±", c: [41.0605, 29.0345], s: ["%70", "%40", "10", "%60", "100"] },
        { n: "Gayrettepe ParkÄ±", c: [41.0695, 29.0065], s: ["%80", "%60", "20", "%70", "130"] },
        { n: "Ulus ParkÄ±", c: [41.0615, 29.0215], s: ["%90", "%75", "18", "%85", "180"] },
        { n: "DikilitaÅŸ ParkÄ±", c: [41.0545, 29.0095], s: ["%60", "%40", "8", "%50", "90"] },
        { n: "CihannÃ¼ma ParkÄ±", c: [41.0435, 29.0045], s: ["%75", "%55", "10", "%65", "110"] },
        { n: "Balmumcu ParkÄ±", c: [41.0625, 29.0125], s: ["%55", "%30", "6", "%50", "70"] },
        { n: "ArnavutkÃ¶y Sahil", c: [41.0675, 29.0435], s: ["%80", "%50", "12", "%70", "130"] },
        { n: "TÃ¼rkali ParkÄ±", c: [41.0515, 29.0035], s: ["%65", "%35", "5", "%55", "60"] },
        { n: "ViÅŸnezade ParkÄ±", c: [41.0415, 28.9985], s: ["%75", "%50", "10", "%65", "100"] },
        { n: "Konaklar ParkÄ±", c: [41.0915, 29.0155], s: ["%85", "%65", "15", "%80", "140"] },
        { n: "KÃ¼ltÃ¼r ParkÄ±", c: [41.0655, 29.0185], s: ["%50", "%25", "4", "%35", "50"] },
        { n: "Etiler ParkÄ±", c: [41.0875, 29.0325], s: ["%95", "%80", "22", "%90", "210"] },
        { n: "SinanpaÅŸa ParkÄ±", c: [41.0425, 29.0065], s: ["%45", "%20", "3", "%30", "40"] },
        { n: "Levent ParkÄ±", c: [41.0825, 29.0125], s: ["%90", "%85", "25", "%90", "300"] }
    ];

    locations.forEach(loc => {
        L.marker(loc.c).addTo(map).on('click', () => {
            document.getElementById('welcome-msg').style.display = 'none';
            document.getElementById('details').style.display = 'block';
            document.getElementById('a-name').innerText = loc.n;
            document.getElementById('a-water').innerText = loc.s[0];
            document.getElementById('a-med').innerText = loc.s[1];
            document.getElementById('a-ext').innerText = loc.s[2] + " Adet";
            document.getElementById('a-food').innerText = loc.s[3];
            document.getElementById('a-blanket').innerText = loc.s[4] + " Adet";
            const d = L.latLng(userLoc).distanceTo(L.latLng(loc.c));
            document.getElementById('a-dist').innerText = `ğŸ“ ${(d/1000).toFixed(2)} km (${Math.round(d/80)} dk)`;
        });
    });

    // YOUTUBE API
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var players = [];
    function onYouTubeIframeAPIReady() {
        var iframes = document.querySelectorAll('.video-thumb iframe');
        iframes.forEach(function(iframe, index) {
            players[index] = new YT.Player(iframe.id, { events: { 'onStateChange': onPlayerStateChange } });
        });
    }
    function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
            players.forEach(function(player) {
                if (player !== event.target && player.pauseVideo) { player.pauseVideo(); }
            });
        }
    }

    // PROFÄ°L YÃ–NETÄ°MÄ° (Ä°STEDÄ°ÄÄ°N GÃœNCEL HALÄ°)
    const profileFields = ['u-name', 'u-blood', 'u-chronic', 'u-meds', 'u-allergy', 'u-phone'];

    window.addEventListener('load', () => {
        profileFields.forEach(field => {
            const savedValue = localStorage.getItem(field);
            if (savedValue) { document.getElementById(field).value = savedValue; }
        });
    });

    function enableEdit() {
        profileFields.forEach(field => {
            document.getElementById(field).removeAttribute('readonly');
            document.getElementById(field).style.background = "#fff";
        });
        document.getElementById('u-name').focus();
    }

    function saveProfile() {
        profileFields.forEach(field => {
            const val = document.getElementById(field).value;
            localStorage.setItem(field, val);
            document.getElementById(field).setAttribute('readonly', true);
            document.getElementById(field).style.background = "#f1f5f9";
        });
        alert("Bilgileriniz baÅŸarÄ±yla kaydedildi!");
    }
</script>
</body>
</html>